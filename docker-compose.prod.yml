# Production Docker Compose for Custom Wiki.js
# Copy this file to your VPS and customize as needed

services:
  db:
    image: postgres:15-alpine
    container_name: wiki-db
    environment:
      POSTGRES_DB: wiki
      POSTGRES_PASSWORD: CHANGE_THIS_PASSWORD
      POSTGRES_USER: wikijs
    restart: unless-stopped
    volumes:
      - wiki-db-data:/var/lib/postgresql/data
    networks:
      - wiki-network
    # Uncomment to expose database port (for admin access)
    # ports:
    #   - "5432:5432"

  wiki:
    # Use your custom image here
    image: wiki-custom:latest
    container_name: wiki
    depends_on:
      - db
    environment:
      DB_TYPE: postgres
      DB_HOST: db
      DB_PORT: 5432
      DB_USER: wikijs
      DB_PASS: CHANGE_THIS_PASSWORD
      DB_NAME: wiki
      # Uncomment for SSL/Let's Encrypt (requires ports 80 and 443)
      # SSL_ACTIVE: "true"
      # LETSENCRYPT_DOMAIN: wiki.example.com
      # LETSENCRYPT_EMAIL: admin@example.com
    restart: unless-stopped
    ports:
      - "80:3000"
      # Uncomment for HTTPS
      # - "443:3443"
    networks:
      - wiki-network
    # Uncomment if you need persistent storage for uploads/data
    # volumes:
    #   - wiki-data:/wiki/data

networks:
  wiki-network:
    driver: bridge

volumes:
  wiki-db-data:
  # wiki-data:

# Usage:
# 1. Copy this file to your VPS
# 2. Update passwords and configuration
# 3. Build your custom image on the VPS or pull from registry
# 4. Run: docker-compose -f docker-compose.prod.yml up -d
#
# To update:
# 1. Build new image
# 2. Run: docker-compose -f docker-compose.prod.yml up -d --force-recreate wiki
#
# To view logs:
# docker-compose -f docker-compose.prod.yml logs -f wiki
#
# To backup database:
# docker-compose -f docker-compose.prod.yml exec db pg_dump -U wikijs wiki > backup.sql
